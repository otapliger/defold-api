<html><head><link rel='stylesheet' type='text/css' href='../defold.css'></head><body><div class='nav'><a class='chevron' href='../index.html'><img src='../svg/chevron-left.svg' alt='Home'></a></div><h1>Collision object</h1>
<p><p>Functions and messages for collision object physics interaction
with other objects (collisions and ray-casting) and control of
physical behaviors.</p></p>
<h1><a name='//apple_ref/cpp/Property/angular_damping' class='dashAnchor'></a><a class='entry' name='angular_damping'>angular_damping</a></h1><div class='brief'><p><span class="type">number</span> collision object angular damping</p></div><p><p>The angular damping value for the collision object. Setting this value alters the damping of
angular motion of the object (rotation). Valid values are between 0 (no damping) and 1 (full damping).</p></p><h3>EXAMPLES</h3><div class='examples'><p><p>How to decrease a collision object component's angular damping:</p>
<div class="codehilite"><pre><span></span><span class="c1">-- get angular damping from collision object &quot;collisionobject&quot; in gameobject &quot;floater&quot;</span>
<span class="kd">local</span> <span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">floater#collisionobject&quot;</span>
<span class="kd">local</span> <span class="n">damping</span> <span class="o">=</span> <span class="n">go</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">angular_damping&quot;</span><span class="p">)</span>
<span class="c1">-- decrease it by 10%</span>
<span class="n">go</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">angular_damping&quot;</span><span class="p">,</span> <span class="n">damping</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span>
</pre></div></p></div><hr/><h1><a name='//apple_ref/cpp/Property/angular_velocity' class='dashAnchor'></a><a class='entry' name='angular_velocity'>angular_velocity</a></h1><div class='brief'><p><span class="type">vector3</span> collision object angular velocity</p></div><p><p><span class="mark">READ ONLY</span> Returns the current angular velocity of the collision object component as a <span class="type">vector3</span>.
The velocity is measured as a rotation around the vector with a speed equivalent to the vector length
in radians/s.</p></p><h3>EXAMPLES</h3><div class='examples'><p><p>How to query a collision object component's angular velocity:</p>
<div class="codehilite"><pre><span></span><span class="c1">-- get angular velocity from collision object &quot;collisionobject&quot; in gameobject &quot;boulder&quot;</span>
<span class="c1">-- this is a 2d game so rotation around z is the only one available.</span>
<span class="kd">local</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">go</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">boulder#collisionobject&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">angular_velocity.z&quot;</span><span class="p">)</span>
<span class="c1">-- do something interesting</span>
<span class="k">if</span> <span class="n">velocity</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="c1">-- clockwise rotation</span>
    <span class="o">...</span>
<span class="k">else</span>
    <span class="c1">-- counter clockwise rotation</span>
    <span class="o">...</span>
<span class="k">end</span>
</pre></div></p></div><hr/><h1><a name='//apple_ref/cpp/Command/apply_force' class='dashAnchor'></a><a class='entry' name='apply_force'>apply_force</a></h1><div class='brief'><p>applies a force on a collision object</p></div><p><p>Post this message to a collision-object-component to apply the specified force on the collision object.
The collision object must be dynamic.</p></p><h3>PARAMETERS</h3><div class='params'><p class='param'>force<p><span class="type">vector3</span> the force to be applied on the collision object, measured in Newton</p></p><p class='param'>position<p><span class="type">vector3</span> the position where the force should be applied</p></p></div><h3>EXAMPLES</h3><div class='examples'><p><p>Assuming the instance of the script has a collision-object-component with id "co":</p>
<div class="codehilite"><pre><span></span><span class="c1">-- apply a force of 1 Newton towards world-x at the center of the game object instance</span>
<span class="n">msg</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">#co&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">apply_force&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">force</span> <span class="o">=</span> <span class="n">vmath</span><span class="p">.</span><span class="n">vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">position</span> <span class="o">=</span> <span class="n">go</span><span class="p">.</span><span class="n">get_world_position</span><span class="p">()})</span>
</pre></div></p></div><hr/><h1><a name='//apple_ref/cpp/Command/collision_response' class='dashAnchor'></a><a class='entry' name='collision_response'>collision_response</a></h1><div class='brief'><p>reports a collision between two collision objects</p></div><p><p>This message is broadcasted to every component of an instance that has a collision object,
when the collision object collides with another collision object. For a script to take action
when such a collision happens, it should check for this message in its <code>on_message</code> callback
function.</p>
<p>This message only reports that a collision actually happened and will only be sent once per
colliding pair and frame.
To retrieve more detailed information, check for the <code>contact_point_response</code> instead.</p></p><h3>PARAMETERS</h3><div class='params'><p class='param'>other_id<p><span class="type">hash</span> the id of the instance the collision object collided with</p></p><p class='param'>other_position<p><span class="type">vector3</span> the world position of the instance the collision object collided with</p></p><p class='param'>other_group<p><span class="type">hash</span> the collision group of the other collision object (hash)</p></p><p class='param'>own_group<p><span class="type">hash</span> the collision group of the own collision object (hash)</p></p></div><h3>EXAMPLES</h3><div class='examples'><p><p>How to take action when a collision occurs:</p>
<div class="codehilite"><pre><span></span><span class="k">function</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">sender</span><span class="p">)</span>
    <span class="c1">-- check for the message</span>
    <span class="k">if</span> <span class="n">message_id</span> <span class="o">==</span> <span class="n">hash</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">collision_response&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- take action</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></p></div><hr/><h1><a name='//apple_ref/cpp/Command/contact_point_response' class='dashAnchor'></a><a class='entry' name='contact_point_response'>contact_point_response</a></h1><div class='brief'><p>reports a contact point between two collision objects</p></div><p><p>This message is broadcasted to every component of an instance that has a collision object,
when the collision object has contact points with respect to another collision object.
For a script to take action when such contact points occur, it should check for this message
in its <code>on_message</code> callback function.</p>
<p>Since multiple contact points can occur for two colliding objects, this message can be sent
multiple times in the same frame for the same two colliding objects. To only be notified once
when the collision occurs, check for the <code>collision_response</code> message instead.</p></p><h3>PARAMETERS</h3><div class='params'><p class='param'>position<p><span class="type">vector3</span> world position of the contact point</p></p><p class='param'>normal<p><span class="type">vector3</span> normal in world space of the contact point, which points from the other object towards the current object</p></p><p class='param'>relative_velocity<p><span class="type">vector3</span> the relative velocity of the collision object as observed from the other object</p></p><p class='param'>distance<p><span class="type">number</span> the penetration distance between the objects, which is always positive</p></p><p class='param'>applied_impulse<p><span class="type">number</span> the impulse the contact resulted in</p></p><p class='param'>life_time<p><span class="type">number</span> life time of the contact, <strong>not currently used</strong></p></p><p class='param'>mass<p><span class="type">number</span> the mass of the current collision object in kg</p></p><p class='param'>other_mass<p><span class="type">number</span> the mass of the other collision object in kg</p></p><p class='param'>other_id<p><span class="type">hash</span> the id of the instance the collision object is in contact with</p></p><p class='param'>other_position<p><span class="type">vector3</span> the world position of the other collision object</p></p><p class='param'>other_group<p><span class="type">hash</span> the collision group of the other collision object (hash)</p></p><p class='param'>own_group<p><span class="type">hash</span> the collision group of the own collision object (hash)</p></p></div><h3>EXAMPLES</h3><div class='examples'><p><p>How to take action when a contact point occurs:</p>
<div class="codehilite"><pre><span></span><span class="k">function</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">sender</span><span class="p">)</span>
    <span class="c1">-- check for the message</span>
    <span class="k">if</span> <span class="n">message_id</span> <span class="o">==</span> <span class="n">hash</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">contact_point_response&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- take action</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></p></div><hr/><h1><a name='//apple_ref/cpp/Property/linear_damping' class='dashAnchor'></a><a class='entry' name='linear_damping'>linear_damping</a></h1><div class='brief'><p><span class="type">number</span> collision object linear damping</p></div><p><p>The linear damping value for the collision object. Setting this value alters the damping of
linear motion of the object. Valid values are between 0 (no damping) and 1 (full damping).</p></p><h3>EXAMPLES</h3><div class='examples'><p><p>How to increase a collision object component's linear damping:</p>
<div class="codehilite"><pre><span></span><span class="c1">-- get linear damping from collision object &quot;collisionobject&quot; in gameobject &quot;floater&quot;</span>
<span class="kd">local</span> <span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">floater#collisionobject&quot;</span>
<span class="kd">local</span> <span class="n">damping</span> <span class="o">=</span> <span class="n">go</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">linear_damping&quot;</span><span class="p">)</span>
<span class="c1">-- increase it by 10% if it&#39;s below 0.9</span>
<span class="k">if</span> <span class="n">damping</span> <span class="o">&lt;=</span> <span class="mf">0.9</span> <span class="k">then</span>
    <span class="n">go</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">linear_damping&quot;</span><span class="p">,</span> <span class="n">damping</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></p></div><hr/><h1><a name='//apple_ref/cpp/Property/linear_velocity' class='dashAnchor'></a><a class='entry' name='linear_velocity'>linear_velocity</a></h1><div class='brief'><p><span class="type">vector3</span> collision object linear velocity</p></div><p><p><span class="mark">READ ONLY</span> Returns the current linear velocity of the collision object component as a vector3.
The velocity is measured in units/s (pixels/s).</p></p><h3>EXAMPLES</h3><div class='examples'><p><p>How to query a collision object component's linear velocity:</p>
<div class="codehilite"><pre><span></span><span class="c1">-- get linear velocity from collision object &quot;collisionobject&quot; in gameobject &quot;ship&quot;</span>
<span class="kd">local</span> <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">ship#collisionobject&quot;</span>
<span class="kd">local</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">go</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">linear_velocity&quot;</span><span class="p">)</span>
<span class="c1">-- apply the velocity on target game object &quot;boulder&quot;&#39;s collision object as a force</span>
<span class="kd">local</span> <span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">boulder#collisionobject&quot;</span>
<span class="kd">local</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">go</span><span class="p">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="n">msg</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">apply_force&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="n">force</span> <span class="o">=</span> <span class="n">velocity</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">pos</span> <span class="p">})</span>
</pre></div></p></div><hr/><h1><a name='//apple_ref/cpp/Property/mass' class='dashAnchor'></a><a class='entry' name='mass'>mass</a></h1><div class='brief'><p><span class="type">number</span> collision object mass</p></div><p><p><span class="mark">READ ONLY</span> Returns the defined physical mass of the collision object component as a number.</p></p><h3>EXAMPLES</h3><div class='examples'><p><p>How to query a collision object component's mass:</p>
<div class="codehilite"><pre><span></span><span class="c1">-- get mass from collision object component &quot;boulder&quot;</span>
<span class="kd">local</span> <span class="n">mass</span> <span class="o">=</span> <span class="n">go</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">#boulder&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">mass&quot;</span><span class="p">)</span>
<span class="c1">-- do something useful</span>
<span class="nb">assert</span><span class="p">(</span><span class="n">mass</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
</pre></div></p></div><hr/><h1><a name='//apple_ref/cpp/Function/physics.ray_cast' class='dashAnchor'></a><a class='entry' name='physics.ray_cast'>physics.ray_cast()</a></h1><div class='brief'><p>requests a ray cast to be performed</p></div><p><p>Ray casts are used to test for intersections against collision objects in the physics world.
Collision objects of types kinematic, dynamic and static are tested against. Trigger objects
do not intersect with ray casts.
Which collision objects to hit is filtered by their collision groups and can be configured
through <code>groups</code>.
The actual ray cast will be performed during the physics-update.</p>
<ul>
<li>If an object is hit, the result will be reported via a <code>ray_cast_response</code> message.</li>
<li>If there is no object hit, the result will be reported via a <code>ray_cast_missed</code> message.</li>
</ul></p><h3>PARAMETERS</h3><div class='params'><p class='param'>from<p><span class="type">vector3</span> the world position of the start of the ray</p></p><p class='param'>to<p><span class="type">vector3</span> the world position of the end of the ray</p></p><p class='param'>groups<p><span class="type">table</span> a lua table containing the hashed groups for which to test collisions against</p></p><p class='param'>[request_id]<p><span class="type">number</span> a number between 0-255 that will be sent back in the response for identification, 0 by default</p></p></div><h3>EXAMPLES</h3><div class='examples'><p><p>How to perform a ray cast:</p>
<div class="codehilite"><pre><span></span><span class="k">function</span> <span class="nf">init</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="n">self</span><span class="p">.</span><span class="n">my_groups</span> <span class="o">=</span> <span class="p">{</span><span class="n">hash</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">my_group1&quot;</span><span class="p">),</span> <span class="n">hash</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">my_group2&quot;</span><span class="p">)}</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="c1">-- request ray cast</span>
    <span class="n">physics</span><span class="p">.</span><span class="n">ray_cast</span><span class="p">(</span><span class="n">my_start</span><span class="p">,</span> <span class="n">my_end</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">my_groups</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">sender</span><span class="p">)</span>
    <span class="c1">-- check for the response</span>
    <span class="k">if</span> <span class="n">message_id</span> <span class="o">==</span> <span class="n">hash</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">ray_cast_response&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- act on the hit</span>
    <span class="k">elseif</span> <span class="n">message_id</span> <span class="o">==</span> <span class="n">hash</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">ray_cast_missed&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- act on the miss</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></p></div><hr/><h1><a name='//apple_ref/cpp/Command/ray_cast_missed' class='dashAnchor'></a><a class='entry' name='ray_cast_missed'>ray_cast_missed</a></h1><div class='brief'><p>reports a ray cast miss</p></div><p><p>This message is sent back to the sender of a <code>ray_cast_request</code>, if the ray didn't hit any
collision object. See <code>physics.ray_cast</code> for examples of how to use it.</p></p><h3>PARAMETERS</h3><div class='params'><p class='param'>request_id<p><span class="type">number</span> id supplied when the ray cast was requested</p></p></div><hr/><h1><a name='//apple_ref/cpp/Command/ray_cast_response' class='dashAnchor'></a><a class='entry' name='ray_cast_response'>ray_cast_response</a></h1><div class='brief'><p>reports a ray cast hit</p></div><p><p>This message is sent back to the sender of a <code>ray_cast_request</code>, if the ray hit a
collision object. See <code>physics.ray_cast</code> for examples of how to use it.</p></p><h3>PARAMETERS</h3><div class='params'><p class='param'>fraction<p><span class="type">number</span> the fraction of the hit measured along the ray, where 0 is the start of the ray and 1 is the end</p></p><p class='param'>position<p><span class="type">vector3</span> the world position of the hit</p></p><p class='param'>normal<p><span class="type">vector3</span> the normal of the surface of the collision object where it was hit</p></p><p class='param'>id<p><span class="type">hash</span> the instance id of the hit collision object</p></p><p class='param'>group<p><span class="type">hash</span> the collision group of the hit collision object as a hashed name</p></p><p class='param'>request_id<p><span class="type">number</span> id supplied when the ray cast was requested</p></p></div><hr/><h1><a name='//apple_ref/cpp/Command/trigger_response' class='dashAnchor'></a><a class='entry' name='trigger_response'>trigger_response</a></h1><div class='brief'><p>reports interaction (enter/exit) between a trigger collision object and another collision object</p></div><p><p>This message is broadcasted to every component of an instance that has a collision object,
when the collision object interacts with another collision object and one of them is a trigger.
For a script to take action when such an interaction happens, it should check for this message
in its <code>on_message</code> callback function.</p>
<p>This message only reports that an interaction actually happened and will only be sent once per
colliding pair and frame. To retrieve more detailed information, check for the
<code>contact_point_response</code> instead.</p></p><h3>PARAMETERS</h3><div class='params'><p class='param'>other_id<p><span class="type">hash</span> the id of the instance the collision object collided with (hash)</p></p><p class='param'>enter<p><span class="type">boolean</span> if the interaction was an entry or not</p></p><p class='param'>other_group<p><span class="type">hash</span> the collision group of the triggering collision object (hash)</p></p><p class='param'>own_group<p><span class="type">hash</span> the collision group of the own collision object (hash)</p></p></div><h3>EXAMPLES</h3><div class='examples'><p><p>How to take action when a trigger interaction occurs:</p>
<div class="codehilite"><pre><span></span><span class="k">function</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">sender</span><span class="p">)</span>
    <span class="c1">-- check for the message</span>
    <span class="k">if</span> <span class="n">message_id</span> <span class="o">==</span> <span class="n">hash</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">trigger_response&quot;</span><span class="p">)</span> <span class="k">then</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">.</span><span class="n">enter</span> <span class="k">then</span>
            <span class="c1">-- take action for entry</span>
        <span class="k">else</span>
            <span class="c1">-- take action for exit</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div></p></div><hr/></body></html>